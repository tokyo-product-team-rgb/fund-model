<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>VC Fund Model Simulator</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:ital,wght@0,600;0,700;0,800;1,600&display=swap" rel="stylesheet">
  <style>
    *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

    :root {
      --bg: #fafaf9;
      --surface: #ffffff;
      --text: #1a1a1a;
      --text-secondary: #555;
      --text-muted: #888;
      --border: #e8e5e1;
      --accent: #1e3a5f;
      --accent-light: #e0f2fe;
      --gp-color: #7c3aed;
      --lp-color: #0891b2;
      --serif: 'Playfair Display', Georgia, serif;
      --sans: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      --shadow-sm: 0 1px 3px rgba(0,0,0,0.04), 0 1px 2px rgba(0,0,0,0.06);
      --shadow-md: 0 4px 12px rgba(0,0,0,0.06), 0 2px 4px rgba(0,0,0,0.04);
      --radius: 8px;
      --green: #16a34a;
      --red: #dc2626;
      --yellow: #ca8a04;
    }

    html { font-size: 16px; }
    body {
      font-family: var(--sans);
      background: var(--bg);
      color: var(--text);
      line-height: 1.65;
    }

    .nav-bar {
      display: flex;
      justify-content: center;
      gap: 0;
      background: var(--surface);
      border-bottom: 1px solid var(--border);
      font-size: 0.8rem;
      font-weight: 500;
    }
    .nav-bar a {
      text-decoration: none;
      color: var(--text-muted);
      padding: 0.7rem 1.5rem;
      border-bottom: 2px solid transparent;
    }
    .nav-bar a.active {
      color: var(--text);
      border-bottom-color: var(--text);
    }

    .masthead {
      background: var(--surface);
      border-bottom: 1px solid var(--border);
    }
    .masthead-inner {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem;
      text-align: center;
    }
    .masthead .overline {
      font-size: 0.7rem;
      font-weight: 600;
      letter-spacing: 0.2em;
      text-transform: uppercase;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
    }
    .masthead h1 {
      font-family: var(--serif);
      font-size: 2rem;
      font-weight: 800;
      color: var(--text);
    }
    .masthead .subtitle {
      color: var(--text-secondary);
      margin-top: 0.5rem;
    }
    .divider-bar {
      width: 60px;
      height: 3px;
      background: var(--accent);
      margin: 1rem auto 0;
      border-radius: 2px;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem 1.5rem 4rem;
    }

    .grid {
      display: grid;
      grid-template-columns: 340px 1fr;
      gap: 2rem;
    }
    @media (max-width: 1000px) {
      .grid { grid-template-columns: 1fr; }
    }

    .panel {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
      box-shadow: var(--shadow-sm);
      margin-bottom: 1.5rem;
    }

    .panel-title {
      font-family: var(--serif);
      font-size: 1.1rem;
      font-weight: 700;
      margin-bottom: 1.25rem;
      padding-bottom: 0.75rem;
      border-bottom: 2px solid var(--border);
      color: var(--accent);
    }

    .input-group {
      margin-bottom: 1rem;
    }

    .input-label {
      display: block;
      font-size: 0.7rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.05em;
      color: var(--text-muted);
      margin-bottom: 0.35rem;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 0.75rem;
    }

    input[type="number"] {
      width: 100%;
      padding: 0.5rem 0.6rem;
      font-size: 0.9rem;
      font-family: var(--sans);
      border: 1px solid var(--border);
      border-radius: 6px;
      background: var(--bg);
      color: var(--text);
    }
    input:focus {
      outline: none;
      border-color: var(--accent);
      box-shadow: 0 0 0 3px rgba(30,58,95,0.1);
    }

    input[type="range"] {
      width: 100%;
      height: 6px;
      border-radius: 3px;
      background: var(--border);
      appearance: none;
      cursor: pointer;
    }
    input[type="range"]::-webkit-slider-thumb {
      appearance: none;
      width: 16px;
      height: 16px;
      border-radius: 50%;
      background: var(--accent);
      cursor: pointer;
    }

    .slider-value {
      min-width: 50px;
      text-align: right;
      font-weight: 700;
      font-size: 0.85rem;
    }

    .section-divider {
      border: none;
      border-top: 1px dashed var(--border);
      margin: 1.25rem 0;
    }

    .section-label {
      font-size: 0.65rem;
      font-weight: 700;
      text-transform: uppercase;
      letter-spacing: 0.1em;
      color: var(--accent);
      margin-bottom: 0.75rem;
    }

    /* Output Cards */
    .output-grid {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 0.75rem;
      margin-bottom: 1.25rem;
    }
    @media (max-width: 700px) {
      .output-grid { grid-template-columns: repeat(2, 1fr); }
    }

    .output-card {
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 0.85rem;
      text-align: center;
    }
    .output-card.highlight {
      background: var(--accent-light);
      border-color: var(--accent);
    }
    .output-card.gp {
      background: #f3e8ff;
      border-color: var(--gp-color);
    }
    .output-card.lp {
      background: #cffafe;
      border-color: var(--lp-color);
    }

    .output-value {
      font-family: var(--serif);
      font-size: 1.5rem;
      font-weight: 800;
      line-height: 1.2;
    }
    .output-value.green { color: var(--green); }
    .output-value.red { color: var(--red); }
    .output-value.gp { color: var(--gp-color); }
    .output-value.lp { color: var(--lp-color); }

    .output-label {
      font-size: 0.65rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-muted);
      margin-top: 0.25rem;
    }

    /* Waterfall */
    .waterfall {
      margin-top: 1rem;
    }

    .waterfall-step {
      display: flex;
      align-items: center;
      padding: 0.75rem;
      border-radius: 6px;
      margin-bottom: 0.5rem;
      font-size: 0.85rem;
    }
    .waterfall-step.header {
      background: var(--text);
      color: #fff;
      font-weight: 600;
    }
    .waterfall-step.lp-row { background: #ecfeff; }
    .waterfall-step.gp-row { background: #faf5ff; }
    .waterfall-step.split-row { background: #f0fdf4; }

    .waterfall-label {
      flex: 1;
      font-weight: 500;
    }
    .waterfall-desc {
      flex: 2;
      color: var(--text-secondary);
      font-size: 0.8rem;
    }
    .waterfall-lp, .waterfall-gp {
      width: 100px;
      text-align: right;
      font-weight: 700;
    }
    .waterfall-lp { color: var(--lp-color); }
    .waterfall-gp { color: var(--gp-color); }

    .waterfall-total {
      display: flex;
      align-items: center;
      padding: 0.85rem;
      background: var(--surface);
      border: 2px solid var(--border);
      border-radius: 6px;
      margin-top: 0.75rem;
      font-weight: 700;
    }

    /* Breakdown Table */
    .breakdown-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 0.8rem;
    }
    .breakdown-table th {
      text-align: left;
      padding: 0.5rem 0.4rem;
      font-size: 0.6rem;
      font-weight: 600;
      text-transform: uppercase;
      letter-spacing: 0.04em;
      color: var(--text-muted);
      border-bottom: 2px solid var(--border);
    }
    .breakdown-table td {
      padding: 0.55rem 0.4rem;
      border-bottom: 1px solid var(--border);
    }
    .breakdown-table tr:last-child td { border-bottom: none; }
    .breakdown-table .engine { font-weight: 600; }
    .breakdown-table .num { text-align: right; font-weight: 600; }
    .breakdown-table .pos { color: var(--green); }

    .breakdown-table tfoot td {
      font-weight: 700;
      border-top: 2px solid var(--border);
      background: var(--bg);
    }

    /* Scenario Status */
    .scenario-status {
      padding: 0.85rem 1rem;
      border-radius: var(--radius);
      margin-bottom: 1.25rem;
      font-size: 0.85rem;
    }
    .scenario-status.success {
      background: #dcfce7;
      border: 1px solid var(--green);
      color: #166534;
    }
    .scenario-status.warning {
      background: #fef9c3;
      border: 1px solid var(--yellow);
      color: #854d0e;
    }
    .scenario-status.danger {
      background: #fee2e2;
      border: 1px solid var(--red);
      color: #991b1b;
    }

    /* Distribution Bar */
    .dist-bar-container {
      margin: 1rem 0;
    }
    .dist-bar-label {
      display: flex;
      justify-content: space-between;
      font-size: 0.7rem;
      font-weight: 600;
      margin-bottom: 0.4rem;
    }
    .dist-bar {
      height: 28px;
      border-radius: 6px;
      overflow: hidden;
      display: flex;
      background: var(--border);
    }
    .dist-bar-lp {
      background: var(--lp-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
    }
    .dist-bar-gp {
      background: var(--gp-color);
      display: flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 0.7rem;
      font-weight: 700;
    }

    .footer {
      text-align: center;
      padding: 2rem;
      font-size: 0.75rem;
      color: var(--text-muted);
    }
  </style>
</head>
<body>

  <nav class="nav-bar">
    <a href="index.html" class="active">Fund Model</a>
  </nav>

  <header class="masthead">
    <div class="masthead-inner">
      <div class="overline">Portfolio Construction Tool</div>
      <h1>VC Fund Model Simulator</h1>
      <p class="subtitle">Stress-test portfolio economics with full waterfall analysis</p>
      <div class="divider-bar"></div>
    </div>
  </header>

  <main class="container">
    <div class="grid">

      <!-- INPUTS PANEL -->
      <div>
        <div class="panel">
          <h2 class="panel-title">ðŸ“Š Fund Parameters</h2>

          <div class="section-label">Fund Basics</div>

          <div class="input-group">
            <label class="input-label">Fund Size ($M)</label>
            <input type="number" id="fundSize" value="1000" min="100" max="5000" step="50">
          </div>

          <div class="input-group">
            <label class="input-label">Management Fee (%)</label>
            <div class="input-row">
              <input type="range" id="mgmtFee" value="2" min="1" max="3" step="0.25">
              <span class="slider-value" id="mgmtFeeVal">2%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Fund Life (Years)</label>
            <input type="number" id="fundLife" value="10" min="5" max="15">
          </div>

          <div class="input-group">
            <label class="input-label">Target Net MOIC</label>
            <input type="number" id="targetMoic" value="5" min="2" max="10" step="0.5">
          </div>

          <hr class="section-divider">
          <div class="section-label">Waterfall Terms</div>

          <div class="input-group">
            <label class="input-label">Carried Interest (%)</label>
            <div class="input-row">
              <input type="range" id="carryPct" value="20" min="10" max="30" step="1">
              <span class="slider-value" id="carryPctVal">20%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Preferred Return / Hurdle (%)</label>
            <div class="input-row">
              <input type="range" id="hurdleRate" value="8" min="0" max="12" step="1">
              <span class="slider-value" id="hurdleRateVal">8%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">GP Catch-up (%)</label>
            <div class="input-row">
              <input type="range" id="catchupPct" value="100" min="0" max="100" step="10">
              <span class="slider-value" id="catchupPctVal">100%</span>
            </div>
          </div>

          <hr class="section-divider">
          <div class="section-label">Capital Allocation</div>

          <div class="input-group">
            <label class="input-label">Discovery (%)</label>
            <div class="input-row">
              <input type="range" id="discoveryPct" value="15" min="5" max="30" step="1">
              <span class="slider-value" id="discoveryPctVal">15%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Core (%)</label>
            <div class="input-row">
              <input type="range" id="corePct" value="73" min="50" max="85" step="1">
              <span class="slider-value" id="corePctVal">73%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Breakout (%)</label>
            <div class="input-row">
              <input type="range" id="breakoutPct" value="12" min="5" max="25" step="1">
              <span class="slider-value" id="breakoutPctVal">12%</span>
            </div>
          </div>

        </div>

        <div class="panel">
          <h2 class="panel-title">ðŸŽ¯ Position Assumptions</h2>

          <div class="section-label">Position Counts</div>

          <div class="input-group">
            <label class="input-label">Discovery Positions</label>
            <input type="number" id="discoveryCount" value="146" min="20" max="300">
          </div>

          <div class="input-group">
            <label class="input-label">Core Positions</label>
            <input type="number" id="coreCount" value="10" min="5" max="30">
          </div>

          <div class="input-group">
            <label class="input-label">Breakout Positions</label>
            <input type="number" id="breakoutCount" value="3" min="1" max="10">
          </div>

          <hr class="section-divider">
          <div class="section-label">Return Multiples (Survivors)</div>

          <div class="input-group">
            <label class="input-label">Discovery Avg Multiple</label>
            <input type="number" id="discoveryMult" value="8" min="1" max="50" step="0.5">
          </div>

          <div class="input-group">
            <label class="input-label">Core Avg Multiple</label>
            <input type="number" id="coreMult" value="12" min="2" max="30" step="0.5">
          </div>

          <div class="input-group">
            <label class="input-label">Breakout Avg Multiple</label>
            <input type="number" id="breakoutMult" value="25" min="5" max="100" step="1">
          </div>

          <hr class="section-divider">
          <div class="section-label">Loss Rates</div>

          <div class="input-group">
            <label class="input-label">Discovery Loss Rate</label>
            <div class="input-row">
              <input type="range" id="discoveryLoss" value="60" min="30" max="80" step="5">
              <span class="slider-value" id="discoveryLossVal">60%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Core Loss Rate</label>
            <div class="input-row">
              <input type="range" id="coreLoss" value="30" min="10" max="50" step="5">
              <span class="slider-value" id="coreLossVal">30%</span>
            </div>
          </div>

          <div class="input-group">
            <label class="input-label">Breakout Loss Rate</label>
            <div class="input-row">
              <input type="range" id="breakoutLoss" value="10" min="0" max="30" step="5">
              <span class="slider-value" id="breakoutLossVal">10%</span>
            </div>
          </div>

        </div>
      </div>

      <!-- OUTPUTS PANEL -->
      <div>

        <div class="panel">
          <h2 class="panel-title">ðŸ’° Fund Economics</h2>

          <div id="scenarioStatus" class="scenario-status success">
            <strong>âœ“ Target Achievable</strong> â€” Model produces 5.2x net MOIC
          </div>

          <div class="output-grid">
            <div class="output-card highlight">
              <div class="output-value green" id="netMoic">5.2x</div>
              <div class="output-label">Net MOIC</div>
            </div>
            <div class="output-card">
              <div class="output-value" id="grossMoic">7.4x</div>
              <div class="output-label">Gross MOIC</div>
            </div>
            <div class="output-card highlight">
              <div class="output-value green" id="netIrr">28.5%</div>
              <div class="output-label">Net IRR</div>
            </div>
            <div class="output-card">
              <div class="output-value" id="investable">$830M</div>
              <div class="output-label">Investable Capital</div>
            </div>
          </div>

          <div class="output-grid">
            <div class="output-card">
              <div class="output-value" id="grossProceeds">$6.1B</div>
              <div class="output-label">Gross Proceeds</div>
            </div>
            <div class="output-card lp">
              <div class="output-value lp" id="lpTotal">$4.2B</div>
              <div class="output-label">LP Total</div>
            </div>
            <div class="output-card gp">
              <div class="output-value gp" id="gpTotal">$1.0B</div>
              <div class="output-label">GP Total</div>
            </div>
            <div class="output-card">
              <div class="output-value" id="lpMoic">4.2x</div>
              <div class="output-label">LP MOIC</div>
            </div>
          </div>

          <!-- Distribution Bar -->
          <div class="dist-bar-container">
            <div class="dist-bar-label">
              <span style="color: var(--lp-color);">LP: <span id="lpPct">81%</span></span>
              <span style="color: var(--gp-color);">GP: <span id="gpPct">19%</span></span>
            </div>
            <div class="dist-bar">
              <div class="dist-bar-lp" id="lpBar" style="width: 81%;">$4.2B</div>
              <div class="dist-bar-gp" id="gpBar" style="width: 19%;">$1.0B</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2 class="panel-title">ðŸŒŠ Fund Waterfall</h2>

          <div class="waterfall">
            <div class="waterfall-step header">
              <div class="waterfall-label">Step</div>
              <div class="waterfall-desc">Description</div>
              <div class="waterfall-lp" style="color:#fff;">LP</div>
              <div class="waterfall-gp" style="color:#fff;">GP</div>
            </div>

            <div class="waterfall-step lp-row">
              <div class="waterfall-label">1. Return of Capital</div>
              <div class="waterfall-desc">LPs get contributed capital back first</div>
              <div class="waterfall-lp" id="wfReturnCapitalLP">$1,000M</div>
              <div class="waterfall-gp">$0</div>
            </div>

            <div class="waterfall-step lp-row">
              <div class="waterfall-label">2. Preferred Return</div>
              <div class="waterfall-desc" id="wfPrefDesc">8% annual hurdle on committed capital</div>
              <div class="waterfall-lp" id="wfPrefReturnLP">$800M</div>
              <div class="waterfall-gp">$0</div>
            </div>

            <div class="waterfall-step gp-row">
              <div class="waterfall-label">3. GP Catch-up</div>
              <div class="waterfall-desc" id="wfCatchupDesc">GP catches up to 20% of profits so far</div>
              <div class="waterfall-lp">$0</div>
              <div class="waterfall-gp" id="wfCatchupGP">$450M</div>
            </div>

            <div class="waterfall-step split-row">
              <div class="waterfall-label">4. Carried Interest Split</div>
              <div class="waterfall-desc" id="wfSplitDesc">Remaining profits split 80/20</div>
              <div class="waterfall-lp" id="wfSplitLP">$2,400M</div>
              <div class="waterfall-gp" id="wfSplitGP">$600M</div>
            </div>

            <div class="waterfall-total">
              <div class="waterfall-label">Total Distributions</div>
              <div class="waterfall-desc"></div>
              <div class="waterfall-lp" id="wfTotalLP">$4,200M</div>
              <div class="waterfall-gp" id="wfTotalGP">$1,050M</div>
            </div>
          </div>
        </div>

        <div class="panel">
          <h2 class="panel-title">ðŸ“ˆ Engine Breakdown</h2>

          <table class="breakdown-table">
            <thead>
              <tr>
                <th>Engine</th>
                <th>Capital</th>
                <th>Positions</th>
                <th>Avg Check</th>
                <th>Survivors</th>
                <th>Gross Return</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td class="engine">Discovery</td>
                <td id="discoveryCapital">$122M</td>
                <td id="discoveryPositions">146</td>
                <td id="discoveryCheck">$836K</td>
                <td id="discoverySurvivors">58</td>
                <td id="discoveryReturn" class="num pos">$390M</td>
              </tr>
              <tr>
                <td class="engine">Core</td>
                <td id="coreCapital">$608M</td>
                <td id="corePositions">10</td>
                <td id="coreCheck">$60.8M</td>
                <td id="coreSurvivors">7</td>
                <td id="coreReturn" class="num pos">$5.1B</td>
              </tr>
              <tr>
                <td class="engine">Breakout</td>
                <td id="breakoutCapital">$100M</td>
                <td id="breakoutPositions">3</td>
                <td id="breakoutCheck">$33.3M</td>
                <td id="breakoutSurvivors">2.7</td>
                <td id="breakoutReturn" class="num pos">$675M</td>
              </tr>
            </tbody>
            <tfoot>
              <tr>
                <td><strong>Total</strong></td>
                <td id="totalCapital"><strong>$830M</strong></td>
                <td id="totalPositions"><strong>159</strong></td>
                <td>â€”</td>
                <td id="totalSurvivors"><strong>68</strong></td>
                <td id="totalReturn" class="num"><strong>$6.1B</strong></td>
              </tr>
            </tfoot>
          </table>

          <div style="margin-top: 1rem; padding: 0.75rem; background: var(--bg); border-radius: 6px; font-size: 0.8rem; color: var(--text-secondary);">
            <strong>Key Insight:</strong> <span id="keyInsight">Core positions drive 82% of returns.</span>
          </div>
        </div>

      </div>
    </div>
  </main>

  <footer class="footer">
    <p>VC Fund Model Simulator Â· Full Waterfall Analysis</p>
  </footer>

  <script>
    const inputs = {
      fundSize: document.getElementById('fundSize'),
      mgmtFee: document.getElementById('mgmtFee'),
      fundLife: document.getElementById('fundLife'),
      targetMoic: document.getElementById('targetMoic'),
      carryPct: document.getElementById('carryPct'),
      hurdleRate: document.getElementById('hurdleRate'),
      catchupPct: document.getElementById('catchupPct'),
      discoveryPct: document.getElementById('discoveryPct'),
      corePct: document.getElementById('corePct'),
      breakoutPct: document.getElementById('breakoutPct'),
      discoveryCount: document.getElementById('discoveryCount'),
      coreCount: document.getElementById('coreCount'),
      breakoutCount: document.getElementById('breakoutCount'),
      discoveryMult: document.getElementById('discoveryMult'),
      coreMult: document.getElementById('coreMult'),
      breakoutMult: document.getElementById('breakoutMult'),
      discoveryLoss: document.getElementById('discoveryLoss'),
      coreLoss: document.getElementById('coreLoss'),
      breakoutLoss: document.getElementById('breakoutLoss'),
    };

    const sliderDisplays = {
      mgmtFee: document.getElementById('mgmtFeeVal'),
      carryPct: document.getElementById('carryPctVal'),
      hurdleRate: document.getElementById('hurdleRateVal'),
      catchupPct: document.getElementById('catchupPctVal'),
      discoveryPct: document.getElementById('discoveryPctVal'),
      corePct: document.getElementById('corePctVal'),
      breakoutPct: document.getElementById('breakoutPctVal'),
      discoveryLoss: document.getElementById('discoveryLossVal'),
      coreLoss: document.getElementById('coreLossVal'),
      breakoutLoss: document.getElementById('breakoutLossVal'),
    };

    function formatMoney(val, decimals = 0) {
      if (val >= 1e9) return '$' + (val / 1e9).toFixed(1) + 'B';
      if (val >= 1e6) return '$' + (val / 1e6).toFixed(decimals) + 'M';
      if (val >= 1e3) return '$' + (val / 1e3).toFixed(0) + 'K';
      return '$' + val.toFixed(0);
    }

    function calculateIRR(investable, grossProceeds, years) {
      // Simplified IRR: solve for r where investable * (1+r)^years = grossProceeds
      // r = (grossProceeds/investable)^(1/years) - 1
      if (grossProceeds <= 0 || investable <= 0) return 0;
      const moic = grossProceeds / investable;
      const irr = Math.pow(moic, 1/years) - 1;
      return irr;
    }

    function calculate() {
      // Get values
      const fundSize = parseFloat(inputs.fundSize.value) * 1e6;
      const mgmtFee = parseFloat(inputs.mgmtFee.value) / 100;
      const fundLife = parseFloat(inputs.fundLife.value);
      const targetMoic = parseFloat(inputs.targetMoic.value);
      const carryPct = parseFloat(inputs.carryPct.value) / 100;
      const hurdleRate = parseFloat(inputs.hurdleRate.value) / 100;
      const catchupPct = parseFloat(inputs.catchupPct.value) / 100;

      const discoveryPct = parseFloat(inputs.discoveryPct.value) / 100;
      const corePct = parseFloat(inputs.corePct.value) / 100;
      const breakoutPct = parseFloat(inputs.breakoutPct.value) / 100;

      const discoveryCount = parseInt(inputs.discoveryCount.value);
      const coreCount = parseInt(inputs.coreCount.value);
      const breakoutCount = parseInt(inputs.breakoutCount.value);

      const discoveryMult = parseFloat(inputs.discoveryMult.value);
      const coreMult = parseFloat(inputs.coreMult.value);
      const breakoutMult = parseFloat(inputs.breakoutMult.value);

      const discoveryLoss = parseFloat(inputs.discoveryLoss.value) / 100;
      const coreLoss = parseFloat(inputs.coreLoss.value) / 100;
      const breakoutLoss = parseFloat(inputs.breakoutLoss.value) / 100;

      // Update slider displays
      sliderDisplays.mgmtFee.textContent = (mgmtFee * 100).toFixed(2) + '%';
      sliderDisplays.carryPct.textContent = (carryPct * 100).toFixed(0) + '%';
      sliderDisplays.hurdleRate.textContent = (hurdleRate * 100).toFixed(0) + '%';
      sliderDisplays.catchupPct.textContent = (catchupPct * 100).toFixed(0) + '%';
      sliderDisplays.discoveryPct.textContent = (discoveryPct * 100).toFixed(0) + '%';
      sliderDisplays.corePct.textContent = (corePct * 100).toFixed(0) + '%';
      sliderDisplays.breakoutPct.textContent = (breakoutPct * 100).toFixed(0) + '%';
      sliderDisplays.discoveryLoss.textContent = (discoveryLoss * 100).toFixed(0) + '%';
      sliderDisplays.coreLoss.textContent = (coreLoss * 100).toFixed(0) + '%';
      sliderDisplays.breakoutLoss.textContent = (breakoutLoss * 100).toFixed(0) + '%';

      // Calculate fees and investable
      const totalFees = fundSize * mgmtFee * fundLife;
      const investable = fundSize - totalFees;

      // Allocation
      const discoveryCapital = investable * discoveryPct;
      const coreCapital = investable * corePct;
      const breakoutCapital = investable * breakoutPct;

      // Check sizes
      const discoveryCheck = discoveryCapital / discoveryCount;
      const coreCheck = coreCapital / coreCount;
      const breakoutCheck = breakoutCapital / breakoutCount;

      // Survivors
      const discoverySurvivors = discoveryCount * (1 - discoveryLoss);
      const coreSurvivors = coreCount * (1 - coreLoss);
      const breakoutSurvivors = breakoutCount * (1 - breakoutLoss);

      // Returns
      const discoveryReturn = discoverySurvivors * discoveryCheck * discoveryMult;
      const coreReturn = coreSurvivors * coreCheck * coreMult;
      const breakoutReturn = breakoutSurvivors * breakoutCheck * breakoutMult;

      const grossProceeds = discoveryReturn + coreReturn + breakoutReturn;
      const grossMoic = grossProceeds / investable;

      // ========== WATERFALL CALCULATION ==========
      let remaining = grossProceeds;
      let lpTotal = 0;
      let gpTotal = 0;

      // Step 1: Return of Capital (to LPs)
      const returnOfCapital = Math.min(remaining, fundSize);
      lpTotal += returnOfCapital;
      remaining -= returnOfCapital;

      // Step 2: Preferred Return (to LPs)
      // Compound preferred return: fundSize * ((1 + hurdle)^years - 1)
      const prefReturn = fundSize * (Math.pow(1 + hurdleRate, fundLife) - 1);
      const actualPrefReturn = Math.min(remaining, prefReturn);
      lpTotal += actualPrefReturn;
      remaining -= actualPrefReturn;

      // Step 3: GP Catch-up
      // GP gets catchupPct of distributions until GP has carryPct of total profits
      // Total profits so far = returnOfCapital + prefReturn - fundSize + remaining (before split)
      // Actually: GP needs to catch up so that GP has carryPct of (prefReturn + catchup + split profits)
      // Simplified: catchup = (prefReturn * carryPct / (1 - carryPct)) * catchupPct
      let gpCatchup = 0;
      if (catchupPct > 0 && remaining > 0) {
        // GP catch-up: GP gets 100% until they have carryPct of profits distributed so far
        // catchup amount = (prefReturn * carryPct) / (1 - carryPct)
        const fullCatchup = (actualPrefReturn * carryPct) / (1 - carryPct);
        gpCatchup = Math.min(remaining, fullCatchup * catchupPct);
        gpTotal += gpCatchup;
        remaining -= gpCatchup;
      }

      // Step 4: Carried Interest Split (remaining profits)
      const lpSplit = remaining * (1 - carryPct);
      const gpSplit = remaining * carryPct;
      lpTotal += lpSplit;
      gpTotal += gpSplit;

      // Final metrics
      const lpMoic = lpTotal / fundSize;
      const netMoic = lpMoic; // Net MOIC = LP MOIC since LPs put in fundSize
      const netIrr = calculateIRR(fundSize, lpTotal, fundLife);

      // ========== UPDATE UI ==========
      
      // Main outputs
      document.getElementById('netMoic').textContent = netMoic.toFixed(1) + 'x';
      document.getElementById('grossMoic').textContent = grossMoic.toFixed(1) + 'x';
      document.getElementById('netIrr').textContent = (netIrr * 100).toFixed(1) + '%';
      document.getElementById('investable').textContent = formatMoney(investable);
      document.getElementById('grossProceeds').textContent = formatMoney(grossProceeds);
      document.getElementById('lpTotal').textContent = formatMoney(lpTotal);
      document.getElementById('gpTotal').textContent = formatMoney(gpTotal);
      document.getElementById('lpMoic').textContent = lpMoic.toFixed(1) + 'x';

      // Distribution bar
      const lpPctVal = (lpTotal / grossProceeds * 100).toFixed(0);
      const gpPctVal = (gpTotal / grossProceeds * 100).toFixed(0);
      document.getElementById('lpPct').textContent = lpPctVal + '%';
      document.getElementById('gpPct').textContent = gpPctVal + '%';
      document.getElementById('lpBar').style.width = lpPctVal + '%';
      document.getElementById('lpBar').textContent = formatMoney(lpTotal);
      document.getElementById('gpBar').style.width = gpPctVal + '%';
      document.getElementById('gpBar').textContent = formatMoney(gpTotal);

      // Waterfall steps
      document.getElementById('wfReturnCapitalLP').textContent = formatMoney(returnOfCapital);
      document.getElementById('wfPrefDesc').textContent = `${(hurdleRate*100).toFixed(0)}% annual hurdle compounded over ${fundLife} years`;
      document.getElementById('wfPrefReturnLP').textContent = formatMoney(actualPrefReturn);
      document.getElementById('wfCatchupDesc').textContent = `GP catches up to ${(carryPct*100).toFixed(0)}% of profits (${(catchupPct*100).toFixed(0)}% catch-up)`;
      document.getElementById('wfCatchupGP').textContent = formatMoney(gpCatchup);
      document.getElementById('wfSplitDesc').textContent = `Remaining profits split ${((1-carryPct)*100).toFixed(0)}/${(carryPct*100).toFixed(0)}`;
      document.getElementById('wfSplitLP').textContent = formatMoney(lpSplit);
      document.getElementById('wfSplitGP').textContent = formatMoney(gpSplit);
      document.getElementById('wfTotalLP').textContent = formatMoney(lpTotal);
      document.getElementById('wfTotalGP').textContent = formatMoney(gpTotal);

      // Breakdown table
      document.getElementById('discoveryCapital').textContent = formatMoney(discoveryCapital);
      document.getElementById('discoveryPositions').textContent = discoveryCount;
      document.getElementById('discoveryCheck').textContent = formatMoney(discoveryCheck);
      document.getElementById('discoverySurvivors').textContent = Math.round(discoverySurvivors);
      document.getElementById('discoveryReturn').textContent = formatMoney(discoveryReturn);

      document.getElementById('coreCapital').textContent = formatMoney(coreCapital);
      document.getElementById('corePositions').textContent = coreCount;
      document.getElementById('coreCheck').textContent = formatMoney(coreCheck, 1);
      document.getElementById('coreSurvivors').textContent = coreSurvivors.toFixed(1);
      document.getElementById('coreReturn').textContent = formatMoney(coreReturn);

      document.getElementById('breakoutCapital').textContent = formatMoney(breakoutCapital);
      document.getElementById('breakoutPositions').textContent = breakoutCount;
      document.getElementById('breakoutCheck').textContent = formatMoney(breakoutCheck, 1);
      document.getElementById('breakoutSurvivors').textContent = breakoutSurvivors.toFixed(1);
      document.getElementById('breakoutReturn').textContent = formatMoney(breakoutReturn);

      document.getElementById('totalCapital').innerHTML = '<strong>' + formatMoney(investable) + '</strong>';
      document.getElementById('totalPositions').innerHTML = '<strong>' + (discoveryCount + coreCount + breakoutCount) + '</strong>';
      document.getElementById('totalSurvivors').innerHTML = '<strong>' + Math.round(discoverySurvivors + coreSurvivors + breakoutSurvivors) + '</strong>';
      document.getElementById('totalReturn').innerHTML = '<strong>' + formatMoney(grossProceeds) + '</strong>';

      // Scenario status
      const statusEl = document.getElementById('scenarioStatus');
      const netMoicEl = document.getElementById('netMoic');
      const netIrrEl = document.getElementById('netIrr');
      
      if (netMoic >= targetMoic) {
        statusEl.className = 'scenario-status success';
        statusEl.innerHTML = `<strong>âœ“ Target Achievable</strong> â€” ${netMoic.toFixed(1)}x net MOIC / ${(netIrr*100).toFixed(1)}% net IRR (target: ${targetMoic}x)`;
        netMoicEl.className = 'output-value green';
        netIrrEl.className = 'output-value green';
      } else if (netMoic >= targetMoic * 0.8) {
        statusEl.className = 'scenario-status warning';
        statusEl.innerHTML = `<strong>âš  Close to Target</strong> â€” ${netMoic.toFixed(1)}x net MOIC / ${(netIrr*100).toFixed(1)}% net IRR (target: ${targetMoic}x)`;
        netMoicEl.className = 'output-value';
        netMoicEl.style.color = 'var(--yellow)';
        netIrrEl.className = 'output-value';
        netIrrEl.style.color = 'var(--yellow)';
      } else {
        statusEl.className = 'scenario-status danger';
        statusEl.innerHTML = `<strong>âœ— Below Target</strong> â€” ${netMoic.toFixed(1)}x net MOIC / ${(netIrr*100).toFixed(1)}% net IRR (target: ${targetMoic}x)`;
        netMoicEl.className = 'output-value red';
        netIrrEl.className = 'output-value red';
      }

      // Key insight
      const coreContribution = coreReturn / grossProceeds * 100;
      document.getElementById('keyInsight').textContent = 
        `Core positions drive ${coreContribution.toFixed(0)}% of gross returns. GP takes home ${formatMoney(gpTotal)} (${gpPctVal}% of proceeds).`;
    }

    // Add event listeners
    Object.values(inputs).forEach(input => {
      input.addEventListener('input', calculate);
    });

    // Initial calculation
    calculate();
  </script>

</body>
</html>
